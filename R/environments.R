# UbiOps
#
# Client Library to interact with the UbiOps API.
#
# UbiOps API version: v2.1
# Generated by custom generator based on: https://openapi-generator.tech

# Environments operations


#' @title List dependency files
#' @description List the dependency files and their contents in an environment build
#' @param build.id  character
#' @param environment.name  character
#' @param revision.id  character
#' @param preload_content (optional) Whether the API response should be preloaded. When TRUE the JSON response string is parsed to an R object. When FALSE, unprocessed API response object is returned. - Default = TRUE
#' @param ...
#'  UBIOPS_PROJECT (system environment variable) UbiOps project name
#'  UBIOPS_API_TOKEN (system environment variable) Token to connect to UbiOps API
#'  UBIOPS_API_URL (optional - system environment variable) UbiOps API url - Default = "https://api.ubiops.com/v2.1"
#'  UBIOPS_TIMEOUT (optional - system environment variable) Maximum request timeout to connect to UbiOps API - Default = NA
#'  UBIOPS_DEFAULT_HEADERS (optional - system environment variable) Default headers to pass to UbiOps API, formatted like "header1:value1,header2:value2" - Default = ""
#' @return Response from the API
#'  A list of details of the dependency files
#'   - `name`: Name of the dependency file
#'   - `content`: Content of the dependency file
#' @examples
#' \dontrun{
#' # Use environment variables
#' Sys.setenv("UBIOPS_PROJECT" = "YOUR PROJECT NAME")
#' Sys.setenv("UBIOPS_API_TOKEN" = "YOUR API TOKEN")
#' result <- ubiops::environment_build_dependencies_list(
#'    build.id, environment.name, revision.id
#' )
#' 
#' # Or provide directly
#' result <- ubiops::environment_build_dependencies_list(
#'    build.id, environment.name, revision.id,
#'    UBIOPS_PROJECT = "YOUR PROJECT NAME", UBIOPS_API_TOKEN = "YOUR API TOKEN"
#' )
#' 
#' print(result)
#' 
#' # The default API url is https://api.ubiops.com/v2.1
#' # Want to use a different API url?
#' # Provide `UBIOPS_API_URL`, either directly or as environment variable.
#' }
#' @export
environment_build_dependencies_list <- function(build.id, environment.name, revision.id,  preload_content=TRUE, ...){
  query_params <- list()

  if (missing(`build.id`)) {
    stop("Missing required parameter `build.id`.")
  }
  if (missing(`environment.name`)) {
    stop("Missing required parameter `environment.name`.")
  }
  if (missing(`revision.id`)) {
    stop("Missing required parameter `revision.id`.")
  }
  
  url_path <- "/projects/{project_name}/environments/{environment_name}/revisions/{revision_id}/builds/{build_id}/dependency-files"
  if (!missing(`build.id`)) {
    url_path <- gsub("\\{build_id\\}", utils::URLencode(as.character(`build.id`), reserved = TRUE), url_path)
  }
  if (!missing(`environment.name`)) {
    url_path <- gsub("\\{environment_name\\}", utils::URLencode(as.character(`environment.name`), reserved = TRUE), url_path)
  }
  if (!missing(`revision.id`)) {
    url_path <- gsub("\\{revision_id\\}", utils::URLencode(as.character(`revision.id`), reserved = TRUE), url_path)
  }

  api.response <- call_api(url_path, "GET", NULL, query_params, ...)
  if (preload_content) {
    deserializedRespObj <- tryCatch(
      deserialize(api.response),
      error = function(e){
        stop("Failed to deserialize response")
      }
    )

  } else {
    ApiResponse$new(api.response)
  }
}


#' @title Get build
#' @description Retrieve details of a build of an environment
#' @param build.id  character
#' @param environment.name  character
#' @param revision.id  character
#' @param preload_content (optional) Whether the API response should be preloaded. When TRUE the JSON response string is parsed to an R object. When FALSE, unprocessed API response object is returned. - Default = TRUE
#' @param ...
#'  UBIOPS_PROJECT (system environment variable) UbiOps project name
#'  UBIOPS_API_TOKEN (system environment variable) Token to connect to UbiOps API
#'  UBIOPS_API_URL (optional - system environment variable) UbiOps API url - Default = "https://api.ubiops.com/v2.1"
#'  UBIOPS_TIMEOUT (optional - system environment variable) Maximum request timeout to connect to UbiOps API - Default = NA
#'  UBIOPS_DEFAULT_HEADERS (optional - system environment variable) Default headers to pass to UbiOps API, formatted like "header1:value1,header2:value2" - Default = ""
#' @return Response from the API
#'  Details of a build
#'   - `id`: Unique identifier for the build
#'   - `revision`: ID of the revision to which the build is linked
#'   - `creation_date`: The date when the build was created
#'   - `status`: Status of the build. It can be one of the following: 'queued', 'processing', 'success' or 'failed'.
#'   - `error_message`: Error message which explains why the build has failed. It is empty if the build is successful.
#'   - `trigger`: Action that triggered the build
#' @examples
#' \dontrun{
#' # Use environment variables
#' Sys.setenv("UBIOPS_PROJECT" = "YOUR PROJECT NAME")
#' Sys.setenv("UBIOPS_API_TOKEN" = "YOUR API TOKEN")
#' result <- ubiops::environment_builds_get(
#'    build.id, environment.name, revision.id
#' )
#' 
#' # Or provide directly
#' result <- ubiops::environment_builds_get(
#'    build.id, environment.name, revision.id,
#'    UBIOPS_PROJECT = "YOUR PROJECT NAME", UBIOPS_API_TOKEN = "YOUR API TOKEN"
#' )
#' 
#' print(result)
#' 
#' # The default API url is https://api.ubiops.com/v2.1
#' # Want to use a different API url?
#' # Provide `UBIOPS_API_URL`, either directly or as environment variable.
#' }
#' @export
environment_builds_get <- function(build.id, environment.name, revision.id,  preload_content=TRUE, ...){
  query_params <- list()

  if (missing(`build.id`)) {
    stop("Missing required parameter `build.id`.")
  }
  if (missing(`environment.name`)) {
    stop("Missing required parameter `environment.name`.")
  }
  if (missing(`revision.id`)) {
    stop("Missing required parameter `revision.id`.")
  }
  
  url_path <- "/projects/{project_name}/environments/{environment_name}/revisions/{revision_id}/builds/{build_id}"
  if (!missing(`build.id`)) {
    url_path <- gsub("\\{build_id\\}", utils::URLencode(as.character(`build.id`), reserved = TRUE), url_path)
  }
  if (!missing(`environment.name`)) {
    url_path <- gsub("\\{environment_name\\}", utils::URLencode(as.character(`environment.name`), reserved = TRUE), url_path)
  }
  if (!missing(`revision.id`)) {
    url_path <- gsub("\\{revision_id\\}", utils::URLencode(as.character(`revision.id`), reserved = TRUE), url_path)
  }

  api.response <- call_api(url_path, "GET", NULL, query_params, ...)
  if (preload_content) {
    deserializedRespObj <- tryCatch(
      deserialize(api.response),
      error = function(e){
        stop("Failed to deserialize response")
      }
    )

  } else {
    ApiResponse$new(api.response)
  }
}


#' @title List builds
#' @description List builds of an environment. A build is triggered when a new environment file is uploaded.
#' @param environment.name  character
#' @param revision.id  character
#' @param preload_content (optional) Whether the API response should be preloaded. When TRUE the JSON response string is parsed to an R object. When FALSE, unprocessed API response object is returned. - Default = TRUE
#' @param ...
#'  UBIOPS_PROJECT (system environment variable) UbiOps project name
#'  UBIOPS_API_TOKEN (system environment variable) Token to connect to UbiOps API
#'  UBIOPS_API_URL (optional - system environment variable) UbiOps API url - Default = "https://api.ubiops.com/v2.1"
#'  UBIOPS_TIMEOUT (optional - system environment variable) Maximum request timeout to connect to UbiOps API - Default = NA
#'  UBIOPS_DEFAULT_HEADERS (optional - system environment variable) Default headers to pass to UbiOps API, formatted like "header1:value1,header2:value2" - Default = ""
#' @return Response from the API
#'  A list of details of the builds
#'   - `id`: Unique identifier for the build
#'   - `revision`: ID of the revision to which the build is linked
#'   - `creation_date`: The date when the build was created
#'   - `status`: Status of the build. It can be one of the following: 'queued', 'processing', 'success' or 'failed'.
#'   - `error_message`: Error message which explains why the build has failed. It is empty if the build is successful.
#'   - `trigger`: Action that triggered the build
#' @examples
#' \dontrun{
#' # Use environment variables
#' Sys.setenv("UBIOPS_PROJECT" = "YOUR PROJECT NAME")
#' Sys.setenv("UBIOPS_API_TOKEN" = "YOUR API TOKEN")
#' result <- ubiops::environment_builds_list(
#'    environment.name, revision.id
#' )
#' 
#' # Or provide directly
#' result <- ubiops::environment_builds_list(
#'    environment.name, revision.id,
#'    UBIOPS_PROJECT = "YOUR PROJECT NAME", UBIOPS_API_TOKEN = "YOUR API TOKEN"
#' )
#' 
#' print(result)
#' 
#' # The default API url is https://api.ubiops.com/v2.1
#' # Want to use a different API url?
#' # Provide `UBIOPS_API_URL`, either directly or as environment variable.
#' }
#' @export
environment_builds_list <- function(environment.name, revision.id,  preload_content=TRUE, ...){
  query_params <- list()

  if (missing(`environment.name`)) {
    stop("Missing required parameter `environment.name`.")
  }
  if (missing(`revision.id`)) {
    stop("Missing required parameter `revision.id`.")
  }
  
  url_path <- "/projects/{project_name}/environments/{environment_name}/revisions/{revision_id}/builds"
  if (!missing(`environment.name`)) {
    url_path <- gsub("\\{environment_name\\}", utils::URLencode(as.character(`environment.name`), reserved = TRUE), url_path)
  }
  if (!missing(`revision.id`)) {
    url_path <- gsub("\\{revision_id\\}", utils::URLencode(as.character(`revision.id`), reserved = TRUE), url_path)
  }

  api.response <- call_api(url_path, "GET", NULL, query_params, ...)
  if (preload_content) {
    deserializedRespObj <- tryCatch(
      deserialize(api.response),
      error = function(e){
        stop("Failed to deserialize response")
      }
    )

  } else {
    ApiResponse$new(api.response)
  }
}


#' @title Update build
#' @description Cancel a build of an environment
#' @param build.id  character
#' @param environment.name  character
#' @param revision.id  character
#' @param data  named list of: [ status ]
#' @param preload_content (optional) Whether the API response should be preloaded. When TRUE the JSON response string is parsed to an R object. When FALSE, unprocessed API response object is returned. - Default = TRUE
#' @param ...
#'  UBIOPS_PROJECT (system environment variable) UbiOps project name
#'  UBIOPS_API_TOKEN (system environment variable) Token to connect to UbiOps API
#'  UBIOPS_API_URL (optional - system environment variable) UbiOps API url - Default = "https://api.ubiops.com/v2.1"
#'  UBIOPS_TIMEOUT (optional - system environment variable) Maximum request timeout to connect to UbiOps API - Default = NA
#'  UBIOPS_DEFAULT_HEADERS (optional - system environment variable) Default headers to pass to UbiOps API, formatted like "header1:value1,header2:value2" - Default = ""
#' @return Response from the API
#'  Details of the cancelled build
#'   - `id`: Unique identifier for the build
#'   - `revision`: ID of the revision to which the build is linked
#'   - `creation_date`: The date when the build was created
#'   - `status`: Status of the build. It can be one of the following: 'queued', 'processing', 'success' or 'failed'.
#'   - `error_message`: Error message which explains why the build has failed. It is empty if the build is successful.
#'   - `trigger`: Action that triggered the build
#' @examples
#' \dontrun{
#' data <- list(
#'  status = "status"
#' )
#'
#' # Use environment variables
#' Sys.setenv("UBIOPS_PROJECT" = "YOUR PROJECT NAME")
#' Sys.setenv("UBIOPS_API_TOKEN" = "YOUR API TOKEN")
#' result <- ubiops::environment_builds_update(
#'    build.id, environment.name, revision.id, data
#' )
#' 
#' # Or provide directly
#' result <- ubiops::environment_builds_update(
#'    build.id, environment.name, revision.id, data,
#'    UBIOPS_PROJECT = "YOUR PROJECT NAME", UBIOPS_API_TOKEN = "YOUR API TOKEN"
#' )
#' 
#' print(result)
#' 
#' # The default API url is https://api.ubiops.com/v2.1
#' # Want to use a different API url?
#' # Provide `UBIOPS_API_URL`, either directly or as environment variable.
#' }
#' @export
environment_builds_update <- function(build.id, environment.name, revision.id, data,  preload_content=TRUE, ...){
  query_params <- list()

  if (missing(`build.id`)) {
    stop("Missing required parameter `build.id`.")
  }
  if (missing(`environment.name`)) {
    stop("Missing required parameter `environment.name`.")
  }
  if (missing(`revision.id`)) {
    stop("Missing required parameter `revision.id`.")
  }
  if (missing(`data`)) {
    stop("Missing required parameter `data`.")
  }
  
  body <- rjson::toJSON(data)
  
  url_path <- "/projects/{project_name}/environments/{environment_name}/revisions/{revision_id}/builds/{build_id}"
  if (!missing(`build.id`)) {
    url_path <- gsub("\\{build_id\\}", utils::URLencode(as.character(`build.id`), reserved = TRUE), url_path)
  }
  if (!missing(`environment.name`)) {
    url_path <- gsub("\\{environment_name\\}", utils::URLencode(as.character(`environment.name`), reserved = TRUE), url_path)
  }
  if (!missing(`revision.id`)) {
    url_path <- gsub("\\{revision_id\\}", utils::URLencode(as.character(`revision.id`), reserved = TRUE), url_path)
  }

  api.response <- call_api(url_path, "PATCH", body, query_params, ...)
  if (preload_content) {
    deserializedRespObj <- tryCatch(
      deserialize(api.response),
      error = function(e){
        stop("Failed to deserialize response")
      }
    )

  } else {
    ApiResponse$new(api.response)
  }
}


#' @title Download environment file
#' @description Download the file of a revision of an environment
#' @param environment.name  character
#' @param revision.id  character
#' @param preload_content (optional) Whether the API response should be preloaded. When TRUE the output file is loaded and written to the storage location defined by UBIOPS_TEMP_FOLDER_PATH. When FALSE, unprocessed API response object is returned. - Default = FALSE
#' @param ...
#'  UBIOPS_TEMP_FOLDER_PATH (system environment variable) Storage location for output file when `preload_content` is set to TRUE - Default = current working directory
#'  UBIOPS_PROJECT (system environment variable) UbiOps project name
#'  UBIOPS_API_TOKEN (system environment variable) Token to connect to UbiOps API
#'  UBIOPS_API_URL (optional - system environment variable) UbiOps API url - Default = "https://api.ubiops.com/v2.1"
#'  UBIOPS_TIMEOUT (optional - system environment variable) Maximum request timeout to connect to UbiOps API - Default = NA
#'  UBIOPS_DEFAULT_HEADERS (optional - system environment variable) Default headers to pass to UbiOps API, formatted like "header1:value1,header2:value2" - Default = ""
#' @return Response from the API
#' @examples
#' \dontrun{
#' # Use environment variables
#' Sys.setenv("UBIOPS_PROJECT" = "YOUR PROJECT NAME")
#' Sys.setenv("UBIOPS_API_TOKEN" = "YOUR API TOKEN")
#' result <- ubiops::environment_revisions_file_download(
#'    environment.name, revision.id
#' )
#' 
#' # Or provide directly
#' result <- ubiops::environment_revisions_file_download(
#'    environment.name, revision.id,
#'    UBIOPS_PROJECT = "YOUR PROJECT NAME", UBIOPS_API_TOKEN = "YOUR API TOKEN"
#' )
#' 
#' # Save file manually
#' file_name <- result$getFileName()
#' 
#' output <- file(file.path(getwd(), file_name), "wb")
#' readr::write_file(result$getContent(), output)
#' close(output)
#' 
#' # Or save file directly in temp folder
#' # by using environment variables or providing directly
#' Sys.setenv("UBIOPS_TEMP_FOLDER_PATH" = getwd())
#' output_path <- ubiops::environment_revisions_file_download(
#'   environment.name, revision.id,
#'   preload_content=TRUE
#' )
#' 
#' # The default API url is https://api.ubiops.com/v2.1
#' # Want to use a different API url?
#' # Provide `UBIOPS_API_URL`, either directly or as environment variable.
#' }
#' @export
environment_revisions_file_download <- function(environment.name, revision.id,  preload_content=FALSE, ...){
  query_params <- list()

  if (missing(`environment.name`)) {
    stop("Missing required parameter `environment.name`.")
  }
  if (missing(`revision.id`)) {
    stop("Missing required parameter `revision.id`.")
  }
  
  url_path <- "/projects/{project_name}/environments/{environment_name}/revisions/{revision_id}/download"
  if (!missing(`environment.name`)) {
    url_path <- gsub("\\{environment_name\\}", utils::URLencode(as.character(`environment.name`), reserved = TRUE), url_path)
  }
  if (!missing(`revision.id`)) {
    url_path <- gsub("\\{revision_id\\}", utils::URLencode(as.character(`revision.id`), reserved = TRUE), url_path)
  }

  api.response <- call_api(url_path, "GET", NULL, query_params, ...)
  if (preload_content) {
    deserialize_file(api.response, ...)

  } else {
    ApiFileResponse$new(api.response)
  }
}


#' @title Upload environment file
#' @description Upload a file for an environment. Uploading a file will create a new revision and trigger a build. This file should contain all the dependencies that the environment should have in the zip format.  It is **also possible** to provide a source environment from which the environment file will be copied. This will also create a new revision and trigger a build.
#' @param environment.name  character
#' @param file (optional) file path - Example: file.path("path", "to", "file")
#' @param source.environment (optional) character
#' @param preload_content (optional) Whether the API response should be preloaded. When TRUE the JSON response string is parsed to an R object. When FALSE, unprocessed API response object is returned. - Default = TRUE
#' @param ...
#'  UBIOPS_PROJECT (system environment variable) UbiOps project name
#'  UBIOPS_API_TOKEN (system environment variable) Token to connect to UbiOps API
#'  UBIOPS_API_URL (optional - system environment variable) UbiOps API url - Default = "https://api.ubiops.com/v2.1"
#'  UBIOPS_TIMEOUT (optional - system environment variable) Maximum request timeout to connect to UbiOps API - Default = NA
#'  UBIOPS_DEFAULT_HEADERS (optional - system environment variable) Default headers to pass to UbiOps API, formatted like "header1:value1,header2:value2" - Default = ""
#' @return Response from the API
#'  - `success`: Boolean indicating whether the environment file upload/copy succeeded
#'   - `revision`: ID of the created revision for the file upload
#'   - `build`: ID of the build created for the file upload
#' @examples
#' \dontrun{
#' # Use environment variables
#' Sys.setenv("UBIOPS_PROJECT" = "YOUR PROJECT NAME")
#' Sys.setenv("UBIOPS_API_TOKEN" = "YOUR API TOKEN")
#' result <- ubiops::environment_revisions_file_upload(
#'    environment.name,
#'    file = NULL, source.environment = NULL
#' )
#' 
#' # Or provide directly
#' result <- ubiops::environment_revisions_file_upload(
#'    environment.name,
#'    file = NULL, source.environment = NULL, 
#'    UBIOPS_PROJECT = "YOUR PROJECT NAME", UBIOPS_API_TOKEN = "YOUR API TOKEN"
#' )
#' 
#' print(result)
#' 
#' # The default API url is https://api.ubiops.com/v2.1
#' # Want to use a different API url?
#' # Provide `UBIOPS_API_URL`, either directly or as environment variable.
#' }
#' @export
environment_revisions_file_upload <- function(environment.name, file=NULL, source.environment=NULL,  preload_content=TRUE, ...){
  query_params <- list()

  if (missing(`environment.name`)) {
    stop("Missing required parameter `environment.name`.")
  }
  body <- list(
    "file" = if (!is.null(`file`)) httr::upload_file(file) else NULL,
    "source_environment" = source.environment
  )
  
  url_path <- "/projects/{project_name}/environments/{environment_name}/revisions"
  if (!missing(`environment.name`)) {
    url_path <- gsub("\\{environment_name\\}", utils::URLencode(as.character(`environment.name`), reserved = TRUE), url_path)
  }

  api.response <- call_api(url_path, "POST", body, query_params, content_type = httr::content_type("multipart/form-data"), ...)
  if (preload_content) {
    deserializedRespObj <- tryCatch(
      deserialize(api.response),
      error = function(e){
        stop("Failed to deserialize response")
      }
    )

  } else {
    ApiResponse$new(api.response)
  }
}


#' @title Get revision
#' @description Retrieve details of a revision of an environment
#' @param environment.name  character
#' @param revision.id  character
#' @param preload_content (optional) Whether the API response should be preloaded. When TRUE the JSON response string is parsed to an R object. When FALSE, unprocessed API response object is returned. - Default = TRUE
#' @param ...
#'  UBIOPS_PROJECT (system environment variable) UbiOps project name
#'  UBIOPS_API_TOKEN (system environment variable) Token to connect to UbiOps API
#'  UBIOPS_API_URL (optional - system environment variable) UbiOps API url - Default = "https://api.ubiops.com/v2.1"
#'  UBIOPS_TIMEOUT (optional - system environment variable) Maximum request timeout to connect to UbiOps API - Default = NA
#'  UBIOPS_DEFAULT_HEADERS (optional - system environment variable) Default headers to pass to UbiOps API, formatted like "header1:value1,header2:value2" - Default = ""
#' @return Response from the API
#'  Details of a revision
#'   - `id`: Unique identifier for the revision
#'   - `environment`: Environment to which the revision is linked
#'   - `creation_date`: The date when the revision was created
#'   - `created_by`: The email of the user that uploaded the environment file. In case the revision is created by a service, the field will have a "UbiOps" value.
#'   - `expired`: A boolean indicating whether the environment file has been deleted for the revision
#' @examples
#' \dontrun{
#' # Use environment variables
#' Sys.setenv("UBIOPS_PROJECT" = "YOUR PROJECT NAME")
#' Sys.setenv("UBIOPS_API_TOKEN" = "YOUR API TOKEN")
#' result <- ubiops::environment_revisions_get(
#'    environment.name, revision.id
#' )
#' 
#' # Or provide directly
#' result <- ubiops::environment_revisions_get(
#'    environment.name, revision.id,
#'    UBIOPS_PROJECT = "YOUR PROJECT NAME", UBIOPS_API_TOKEN = "YOUR API TOKEN"
#' )
#' 
#' print(result)
#' 
#' # The default API url is https://api.ubiops.com/v2.1
#' # Want to use a different API url?
#' # Provide `UBIOPS_API_URL`, either directly or as environment variable.
#' }
#' @export
environment_revisions_get <- function(environment.name, revision.id,  preload_content=TRUE, ...){
  query_params <- list()

  if (missing(`environment.name`)) {
    stop("Missing required parameter `environment.name`.")
  }
  if (missing(`revision.id`)) {
    stop("Missing required parameter `revision.id`.")
  }
  
  url_path <- "/projects/{project_name}/environments/{environment_name}/revisions/{revision_id}"
  if (!missing(`environment.name`)) {
    url_path <- gsub("\\{environment_name\\}", utils::URLencode(as.character(`environment.name`), reserved = TRUE), url_path)
  }
  if (!missing(`revision.id`)) {
    url_path <- gsub("\\{revision_id\\}", utils::URLencode(as.character(`revision.id`), reserved = TRUE), url_path)
  }

  api.response <- call_api(url_path, "GET", NULL, query_params, ...)
  if (preload_content) {
    deserializedRespObj <- tryCatch(
      deserialize(api.response),
      error = function(e){
        stop("Failed to deserialize response")
      }
    )

  } else {
    ApiResponse$new(api.response)
  }
}


#' @title List revisions
#' @description List revisions of an environment
#' @param environment.name  character
#' @param preload_content (optional) Whether the API response should be preloaded. When TRUE the JSON response string is parsed to an R object. When FALSE, unprocessed API response object is returned. - Default = TRUE
#' @param ...
#'  UBIOPS_PROJECT (system environment variable) UbiOps project name
#'  UBIOPS_API_TOKEN (system environment variable) Token to connect to UbiOps API
#'  UBIOPS_API_URL (optional - system environment variable) UbiOps API url - Default = "https://api.ubiops.com/v2.1"
#'  UBIOPS_TIMEOUT (optional - system environment variable) Maximum request timeout to connect to UbiOps API - Default = NA
#'  UBIOPS_DEFAULT_HEADERS (optional - system environment variable) Default headers to pass to UbiOps API, formatted like "header1:value1,header2:value2" - Default = ""
#' @return Response from the API
#'  A list of details of the revisions
#'   - `id`: Unique identifier for the revision
#'   - `environment`: Environment to which the revision is linked
#'   - `creation_date`: The date when the revision was created
#'   - `created_by`: The email of the user that uploaded the environment file. In case the revision is created by a service, the field will have a "UbiOps" value.
#'   - `expired`: A boolean indicating whether the environment file has been deleted for the revision
#' @examples
#' \dontrun{
#' # Use environment variables
#' Sys.setenv("UBIOPS_PROJECT" = "YOUR PROJECT NAME")
#' Sys.setenv("UBIOPS_API_TOKEN" = "YOUR API TOKEN")
#' result <- ubiops::environment_revisions_list(
#'    environment.name
#' )
#' 
#' # Or provide directly
#' result <- ubiops::environment_revisions_list(
#'    environment.name,
#'    UBIOPS_PROJECT = "YOUR PROJECT NAME", UBIOPS_API_TOKEN = "YOUR API TOKEN"
#' )
#' 
#' print(result)
#' 
#' # The default API url is https://api.ubiops.com/v2.1
#' # Want to use a different API url?
#' # Provide `UBIOPS_API_URL`, either directly or as environment variable.
#' }
#' @export
environment_revisions_list <- function(environment.name,  preload_content=TRUE, ...){
  query_params <- list()

  if (missing(`environment.name`)) {
    stop("Missing required parameter `environment.name`.")
  }
  
  url_path <- "/projects/{project_name}/environments/{environment_name}/revisions"
  if (!missing(`environment.name`)) {
    url_path <- gsub("\\{environment_name\\}", utils::URLencode(as.character(`environment.name`), reserved = TRUE), url_path)
  }

  api.response <- call_api(url_path, "GET", NULL, query_params, ...)
  if (preload_content) {
    deserializedRespObj <- tryCatch(
      deserialize(api.response),
      error = function(e){
        stop("Failed to deserialize response")
      }
    )

  } else {
    ApiResponse$new(api.response)
  }
}


#' @title Rebuild revision
#' @description Trigger a rebuild for a revision of an environment
#' @param environment.name  character
#' @param revision.id  character
#' @param data (optional) list(key = "value")
#' @param preload_content (optional) Whether the API response should be preloaded. When TRUE the JSON response string is parsed to an R object. When FALSE, unprocessed API response object is returned. - Default = TRUE
#' @param ...
#'  UBIOPS_PROJECT (system environment variable) UbiOps project name
#'  UBIOPS_API_TOKEN (system environment variable) Token to connect to UbiOps API
#'  UBIOPS_API_URL (optional - system environment variable) UbiOps API url - Default = "https://api.ubiops.com/v2.1"
#'  UBIOPS_TIMEOUT (optional - system environment variable) Maximum request timeout to connect to UbiOps API - Default = NA
#'  UBIOPS_DEFAULT_HEADERS (optional - system environment variable) Default headers to pass to UbiOps API, formatted like "header1:value1,header2:value2" - Default = ""
#' @return Response from the API
#'  Details of the created build
#'   - `id`: Unique identifier for the build
#'   - `revision`: ID of the revision to which the build is linked
#'   - `creation_date`: The date when the build was created
#'   - `status`: Status of the build. It can be one of the following: 'queued', 'processing', 'success' or 'failed'.
#'   - `error_message`: Error message which explains why the build has failed. It is empty if the build is successful.
#'   - `trigger`: Action that triggered the build
#' @examples
#' \dontrun{
#' # Use environment variables
#' Sys.setenv("UBIOPS_PROJECT" = "YOUR PROJECT NAME")
#' Sys.setenv("UBIOPS_API_TOKEN" = "YOUR API TOKEN")
#' result <- ubiops::environment_revisions_rebuild(
#'    environment.name, revision.id,
#'    data = NULL
#' )
#' 
#' # Or provide directly
#' result <- ubiops::environment_revisions_rebuild(
#'    environment.name, revision.id,
#'    data = NULL, 
#'    UBIOPS_PROJECT = "YOUR PROJECT NAME", UBIOPS_API_TOKEN = "YOUR API TOKEN"
#' )
#' 
#' print(result)
#' 
#' # The default API url is https://api.ubiops.com/v2.1
#' # Want to use a different API url?
#' # Provide `UBIOPS_API_URL`, either directly or as environment variable.
#' }
#' @export
environment_revisions_rebuild <- function(environment.name, revision.id, data=NULL,  preload_content=TRUE, ...){
  query_params <- list()

  if (missing(`environment.name`)) {
    stop("Missing required parameter `environment.name`.")
  }
  if (missing(`revision.id`)) {
    stop("Missing required parameter `revision.id`.")
  }
  
  if (!missing(`data`) && !is.null(`data`)) {
    body <- rjson::toJSON(data)
  } else {
    body <- NULL
  }
  url_path <- "/projects/{project_name}/environments/{environment_name}/revisions/{revision_id}/rebuild"
  if (!missing(`environment.name`)) {
    url_path <- gsub("\\{environment_name\\}", utils::URLencode(as.character(`environment.name`), reserved = TRUE), url_path)
  }
  if (!missing(`revision.id`)) {
    url_path <- gsub("\\{revision_id\\}", utils::URLencode(as.character(`revision.id`), reserved = TRUE), url_path)
  }

  api.response <- call_api(url_path, "POST", body, query_params, ...)
  if (preload_content) {
    deserializedRespObj <- tryCatch(
      deserialize(api.response),
      error = function(e){
        stop("Failed to deserialize response")
      }
    )

  } else {
    ApiResponse$new(api.response)
  }
}


#' @title Create environments
#' @description Create a custom environment
#' @param data  named list of: [ name, display_name (optional), base_environment, description (optional), labels (optional) ]
#' @param preload_content (optional) Whether the API response should be preloaded. When TRUE the JSON response string is parsed to an R object. When FALSE, unprocessed API response object is returned. - Default = TRUE
#' @param ...
#'  UBIOPS_PROJECT (system environment variable) UbiOps project name
#'  UBIOPS_API_TOKEN (system environment variable) Token to connect to UbiOps API
#'  UBIOPS_API_URL (optional - system environment variable) UbiOps API url - Default = "https://api.ubiops.com/v2.1"
#'  UBIOPS_TIMEOUT (optional - system environment variable) Maximum request timeout to connect to UbiOps API - Default = NA
#'  UBIOPS_DEFAULT_HEADERS (optional - system environment variable) Default headers to pass to UbiOps API, formatted like "header1:value1,header2:value2" - Default = ""
#' @return Response from the API
#'  Details of the created environment
#'   - `id`: Unique identifier for the environment
#'   - `name`: Name of the environment
#'   - `display_name`: Display name of the environment
#'   - `base_environment`: Base environment name on which this environment is based
#'   - `project`: Project name in which the environment is defined
#'   - `creation_date`: The date when the environment was created
#'   - `last_updated`: The date when the environment was last updated
#'   - `description`: Description of the environment
#'   - `labels`: Dictionary containing key/value pairs where key indicates the label and value is the corresponding value of that label
#'   - `gpu_required`: A boolean indicating whether the environment requires GPUs
#'   - `status`: Status of the environment
#'   - `implicit`: A boolean indicating whether the environment is implicitly created
#'   - `hidden`: A boolean indicating whether the environment is hidden
#'   - `deprecated`: A boolean indicating whether the environment is deprecated
#' @examples
#' \dontrun{
#' data <- list(
#'  name = "name",
#'  display_name = "display_name",  # (optional)
#'  base_environment = "base_environment",
#'  description = "description",  # (optional)
#'  labels = list(key = "value")  # (optional)
#' )
#'
#' # Use environment variables
#' Sys.setenv("UBIOPS_PROJECT" = "YOUR PROJECT NAME")
#' Sys.setenv("UBIOPS_API_TOKEN" = "YOUR API TOKEN")
#' result <- ubiops::environments_create(
#'    data
#' )
#' 
#' # Or provide directly
#' result <- ubiops::environments_create(
#'    data,
#'    UBIOPS_PROJECT = "YOUR PROJECT NAME", UBIOPS_API_TOKEN = "YOUR API TOKEN"
#' )
#' 
#' print(result)
#' 
#' # The default API url is https://api.ubiops.com/v2.1
#' # Want to use a different API url?
#' # Provide `UBIOPS_API_URL`, either directly or as environment variable.
#' }
#' @export
environments_create <- function(data,  preload_content=TRUE, ...){
  query_params <- list()

  if (missing(`data`)) {
    stop("Missing required parameter `data`.")
  }
  
  body <- rjson::toJSON(data)
  
  url_path <- "/projects/{project_name}/environments"

  api.response <- call_api(url_path, "POST", body, query_params, ...)
  if (preload_content) {
    deserializedRespObj <- tryCatch(
      deserialize(api.response),
      error = function(e){
        stop("Failed to deserialize response")
      }
    )

  } else {
    ApiResponse$new(api.response)
  }
}


#' @title Delete environment
#' @description Delete an environment. The environment cannot be deleted if it is referenced by a deployment version.
#' @param environment.name  character
#' @param ...
#'  UBIOPS_PROJECT (system environment variable) UbiOps project name
#'  UBIOPS_API_TOKEN (system environment variable) Token to connect to UbiOps API
#'  UBIOPS_API_URL (optional - system environment variable) UbiOps API url - Default = "https://api.ubiops.com/v2.1"
#'  UBIOPS_TIMEOUT (optional - system environment variable) Maximum request timeout to connect to UbiOps API - Default = NA
#'  UBIOPS_DEFAULT_HEADERS (optional - system environment variable) Default headers to pass to UbiOps API, formatted like "header1:value1,header2:value2" - Default = ""
#' @return Response from the API
#' @examples
#' \dontrun{
#' # Use environment variables
#' Sys.setenv("UBIOPS_PROJECT" = "YOUR PROJECT NAME")
#' Sys.setenv("UBIOPS_API_TOKEN" = "YOUR API TOKEN")
#' ubiops::environments_delete(
#'    environment.name
#' )
#' 
#' # Or provide directly
#' ubiops::environments_delete(
#'    environment.name,
#'    UBIOPS_PROJECT = "YOUR PROJECT NAME", UBIOPS_API_TOKEN = "YOUR API TOKEN"
#' )
#' 
#' # The default API url is https://api.ubiops.com/v2.1
#' # Want to use a different API url?
#' # Provide `UBIOPS_API_URL`, either directly or as environment variable.
#' }
#' @export
environments_delete <- function(environment.name,  ...){
  query_params <- list()

  if (missing(`environment.name`)) {
    stop("Missing required parameter `environment.name`.")
  }
  
  url_path <- "/projects/{project_name}/environments/{environment_name}"
  if (!missing(`environment.name`)) {
    url_path <- gsub("\\{environment_name\\}", utils::URLencode(as.character(`environment.name`), reserved = TRUE), url_path)
  }

  api.response <- call_api(url_path, "DELETE", NULL, query_params, ...)
  return(invisible(NULL))
}


#' @title Get environment
#' @description Retrieve details of an environment
#' @param environment.name  character
#' @param preload_content (optional) Whether the API response should be preloaded. When TRUE the JSON response string is parsed to an R object. When FALSE, unprocessed API response object is returned. - Default = TRUE
#' @param ...
#'  UBIOPS_PROJECT (system environment variable) UbiOps project name
#'  UBIOPS_API_TOKEN (system environment variable) Token to connect to UbiOps API
#'  UBIOPS_API_URL (optional - system environment variable) UbiOps API url - Default = "https://api.ubiops.com/v2.1"
#'  UBIOPS_TIMEOUT (optional - system environment variable) Maximum request timeout to connect to UbiOps API - Default = NA
#'  UBIOPS_DEFAULT_HEADERS (optional - system environment variable) Default headers to pass to UbiOps API, formatted like "header1:value1,header2:value2" - Default = ""
#' @return Response from the API
#'  Details of an environment
#'   - `id`: Unique identifier for the environment
#'   - `name`: Name of the environment
#'   - `display_name`: Display name of the environment
#'   - `base_environment`: Base environment name on which this environment is based
#'   - `project`: Project name in which the environment is defined
#'   - `creation_date`: The date when the environment was created
#'   - `last_updated`: The date when the environment was last updated
#'   - `description`: Description of the environment
#'   - `labels`: Dictionary containing key/value pairs where key indicates the label and value is the corresponding value of that label
#'   - `gpu_required`: A boolean indicating whether the environment requires GPUs
#'   - `status`: Status of the environment
#'   - `active_revision`: UUID of the active revision of the environment
#'   - `active_build`: UUID of the active build of the environment
#'   - `latest_revision`: UUID of the latest revision of the environment
#'   - `latest_build`: UUID of the latest build of the environment
#'   - `implicit`: A boolean indicating whether the environment is implicitly created
#'   - `hidden`: A boolean indicating whether the environment is hidden
#'   - `deprecated`: A boolean indicating whether the environment is deprecated
#' @examples
#' \dontrun{
#' # Use environment variables
#' Sys.setenv("UBIOPS_PROJECT" = "YOUR PROJECT NAME")
#' Sys.setenv("UBIOPS_API_TOKEN" = "YOUR API TOKEN")
#' result <- ubiops::environments_get(
#'    environment.name
#' )
#' 
#' # Or provide directly
#' result <- ubiops::environments_get(
#'    environment.name,
#'    UBIOPS_PROJECT = "YOUR PROJECT NAME", UBIOPS_API_TOKEN = "YOUR API TOKEN"
#' )
#' 
#' print(result)
#' 
#' # The default API url is https://api.ubiops.com/v2.1
#' # Want to use a different API url?
#' # Provide `UBIOPS_API_URL`, either directly or as environment variable.
#' }
#' @export
environments_get <- function(environment.name,  preload_content=TRUE, ...){
  query_params <- list()

  if (missing(`environment.name`)) {
    stop("Missing required parameter `environment.name`.")
  }
  
  url_path <- "/projects/{project_name}/environments/{environment_name}"
  if (!missing(`environment.name`)) {
    url_path <- gsub("\\{environment_name\\}", utils::URLencode(as.character(`environment.name`), reserved = TRUE), url_path)
  }

  api.response <- call_api(url_path, "GET", NULL, query_params, ...)
  if (preload_content) {
    deserializedRespObj <- tryCatch(
      deserialize(api.response),
      error = function(e){
        stop("Failed to deserialize response")
      }
    )

  } else {
    ApiResponse$new(api.response)
  }
}


#' @title List environments
#' @description Environments can be filtered according to the labels they have by giving labels as a query parameter. Environments that have at least one of the labels on which is filtered, are returned.
#' @param labels (optional) character - Example: "label1:value1,label2:value2"
#' @param environment.type (optional) character
#' @param preload_content (optional) Whether the API response should be preloaded. When TRUE the JSON response string is parsed to an R object. When FALSE, unprocessed API response object is returned. - Default = TRUE
#' @param ...
#'  UBIOPS_PROJECT (system environment variable) UbiOps project name
#'  UBIOPS_API_TOKEN (system environment variable) Token to connect to UbiOps API
#'  UBIOPS_API_URL (optional - system environment variable) UbiOps API url - Default = "https://api.ubiops.com/v2.1"
#'  UBIOPS_TIMEOUT (optional - system environment variable) Maximum request timeout to connect to UbiOps API - Default = NA
#'  UBIOPS_DEFAULT_HEADERS (optional - system environment variable) Default headers to pass to UbiOps API, formatted like "header1:value1,header2:value2" - Default = ""
#' @return Response from the API
#'  A list of details of the environments
#'   - `id`: Unique identifier for the environment
#'   - `name`: Name of the environment
#'   - `display_name`: Display name of the environment
#'   - `base_environment`: Base environment name on which this environment is based
#'   - `project`: Project name in which the environment is defined. It is null for base environments.
#'   - `creation_date`: The date when the environment was created
#'   - `last_updated`: The date when the environment was last updated
#'   - `description`: Description of the environment
#'   - `labels`: Dictionary containing key/value pairs where key indicates the label and value is the corresponding value of that label
#'   - `gpu_required`: A boolean indicating whether the environment requires GPUs
#'   - `status`: Status of the environment
#'   - `implicit`: A boolean indicating whether the environment is implicitly created
#'   - `hidden`: A boolean indicating whether the environment is hidden
#'   - `deprecated`: A boolean indicating whether the environment is deprecated
#' @examples
#' \dontrun{
#' # Use environment variables
#' Sys.setenv("UBIOPS_PROJECT" = "YOUR PROJECT NAME")
#' Sys.setenv("UBIOPS_API_TOKEN" = "YOUR API TOKEN")
#' result <- ubiops::environments_list(
#'    
#'    labels = NULL, environment.type = NULL
#' )
#' 
#' # Or provide directly
#' result <- ubiops::environments_list(
#'    
#'    labels = NULL, environment.type = NULL, 
#'    UBIOPS_PROJECT = "YOUR PROJECT NAME", UBIOPS_API_TOKEN = "YOUR API TOKEN"
#' )
#' 
#' print(result)
#' 
#' # The default API url is https://api.ubiops.com/v2.1
#' # Want to use a different API url?
#' # Provide `UBIOPS_API_URL`, either directly or as environment variable.
#' }
#' @export
environments_list <- function(labels=NULL, environment.type=NULL,  preload_content=TRUE, ...){
  query_params <- list()

  query_params['labels'] <- labels
  query_params['environment_type'] <- environment.type
  
  url_path <- "/projects/{project_name}/environments"

  api.response <- call_api(url_path, "GET", NULL, query_params, ...)
  if (preload_content) {
    deserializedRespObj <- tryCatch(
      deserialize(api.response),
      error = function(e){
        stop("Failed to deserialize response")
      }
    )

  } else {
    ApiResponse$new(api.response)
  }
}


#' @title Update environment
#' @description Update an environment. When updating labels, the labels will replace the existing value for labels.
#' @param environment.name  character
#' @param data  named list of: [ name (optional), display_name (optional), description (optional), labels (optional) ]
#' @param preload_content (optional) Whether the API response should be preloaded. When TRUE the JSON response string is parsed to an R object. When FALSE, unprocessed API response object is returned. - Default = TRUE
#' @param ...
#'  UBIOPS_PROJECT (system environment variable) UbiOps project name
#'  UBIOPS_API_TOKEN (system environment variable) Token to connect to UbiOps API
#'  UBIOPS_API_URL (optional - system environment variable) UbiOps API url - Default = "https://api.ubiops.com/v2.1"
#'  UBIOPS_TIMEOUT (optional - system environment variable) Maximum request timeout to connect to UbiOps API - Default = NA
#'  UBIOPS_DEFAULT_HEADERS (optional - system environment variable) Default headers to pass to UbiOps API, formatted like "header1:value1,header2:value2" - Default = ""
#' @return Response from the API
#'  Details of the updated environment
#'   - `id`: Unique identifier for the environment
#'   - `name`: Name of the environment
#'   - `display_name`: Display name of the environment
#'   - `base_environment`: Base environment name on which this environment is based
#'   - `project`: Project name in which the environment is defined
#'   - `creation_date`: The date when the environment was created
#'   - `last_updated`: The date when the environment was last updated
#'   - `description`: Description of the environment
#'   - `labels`: Dictionary containing key/value pairs where key indicates the label and value is the corresponding value of that label
#'   - `gpu_required`: A boolean indicating whether the environment requires GPUs
#'   - `status`: Status of the environment
#'   - `active_revision`: UUID of the active revision of the environment
#'   - `active_build`: UUID of the active build of the environment
#'   - `latest_revision`: UUID of the latest revision of the environment
#'   - `latest_build`: UUID of the latest build of the environment
#'   - `implicit`: A boolean indicating whether the environment is implicitly created
#'   - `hidden`: A boolean indicating whether the environment is hidden
#'   - `deprecated`: A boolean indicating whether the environment is deprecated
#' @examples
#' \dontrun{
#' data <- list(
#'  name = "name",  # (optional)
#'  display_name = "display_name",  # (optional)
#'  description = "description",  # (optional)
#'  labels = list(key = "value")  # (optional)
#' )
#'
#' # Use environment variables
#' Sys.setenv("UBIOPS_PROJECT" = "YOUR PROJECT NAME")
#' Sys.setenv("UBIOPS_API_TOKEN" = "YOUR API TOKEN")
#' result <- ubiops::environments_update(
#'    environment.name, data
#' )
#' 
#' # Or provide directly
#' result <- ubiops::environments_update(
#'    environment.name, data,
#'    UBIOPS_PROJECT = "YOUR PROJECT NAME", UBIOPS_API_TOKEN = "YOUR API TOKEN"
#' )
#' 
#' print(result)
#' 
#' # The default API url is https://api.ubiops.com/v2.1
#' # Want to use a different API url?
#' # Provide `UBIOPS_API_URL`, either directly or as environment variable.
#' }
#' @export
environments_update <- function(environment.name, data,  preload_content=TRUE, ...){
  query_params <- list()

  if (missing(`environment.name`)) {
    stop("Missing required parameter `environment.name`.")
  }
  if (missing(`data`)) {
    stop("Missing required parameter `data`.")
  }
  
  body <- rjson::toJSON(data)
  
  url_path <- "/projects/{project_name}/environments/{environment_name}"
  if (!missing(`environment.name`)) {
    url_path <- gsub("\\{environment_name\\}", utils::URLencode(as.character(`environment.name`), reserved = TRUE), url_path)
  }

  api.response <- call_api(url_path, "PATCH", body, query_params, ...)
  if (preload_content) {
    deserializedRespObj <- tryCatch(
      deserialize(api.response),
      error = function(e){
        stop("Failed to deserialize response")
      }
    )

  } else {
    ApiResponse$new(api.response)
  }
}


#' @title List usage of environment
#' @description List the deployment versions used by an environment
#' @param environment.name  character
#' @param environment.type (optional) character
#' @param preload_content (optional) Whether the API response should be preloaded. When TRUE the JSON response string is parsed to an R object. When FALSE, unprocessed API response object is returned. - Default = TRUE
#' @param ...
#'  UBIOPS_PROJECT (system environment variable) UbiOps project name
#'  UBIOPS_API_TOKEN (system environment variable) Token to connect to UbiOps API
#'  UBIOPS_API_URL (optional - system environment variable) UbiOps API url - Default = "https://api.ubiops.com/v2.1"
#'  UBIOPS_TIMEOUT (optional - system environment variable) Maximum request timeout to connect to UbiOps API - Default = NA
#'  UBIOPS_DEFAULT_HEADERS (optional - system environment variable) Default headers to pass to UbiOps API, formatted like "header1:value1,header2:value2" - Default = ""
#' @return Response from the API
#'  A list of details of the deployment versions
#'   - `id`: Unique identifier for the deployment version (UUID)
#'   - `deployment`: Deployment name to which the version is associated
#'   - `version`: Version name
#'   - `environment`: Environment of the version
#'   - `environment_display_name`: Human readable name of the environment
#'   - `status`: The status of the version
#' @examples
#' \dontrun{
#' # Use environment variables
#' Sys.setenv("UBIOPS_PROJECT" = "YOUR PROJECT NAME")
#' Sys.setenv("UBIOPS_API_TOKEN" = "YOUR API TOKEN")
#' result <- ubiops::environments_usage(
#'    environment.name,
#'    environment.type = NULL
#' )
#' 
#' # Or provide directly
#' result <- ubiops::environments_usage(
#'    environment.name,
#'    environment.type = NULL, 
#'    UBIOPS_PROJECT = "YOUR PROJECT NAME", UBIOPS_API_TOKEN = "YOUR API TOKEN"
#' )
#' 
#' print(result)
#' 
#' # The default API url is https://api.ubiops.com/v2.1
#' # Want to use a different API url?
#' # Provide `UBIOPS_API_URL`, either directly or as environment variable.
#' }
#' @export
environments_usage <- function(environment.name, environment.type=NULL,  preload_content=TRUE, ...){
  query_params <- list()

  if (missing(`environment.name`)) {
    stop("Missing required parameter `environment.name`.")
  }
  query_params['environment_type'] <- environment.type
  
  url_path <- "/projects/{project_name}/environments/{environment_name}/usage"
  if (!missing(`environment.name`)) {
    url_path <- gsub("\\{environment_name\\}", utils::URLencode(as.character(`environment.name`), reserved = TRUE), url_path)
  }

  api.response <- call_api(url_path, "GET", NULL, query_params, ...)
  if (preload_content) {
    deserializedRespObj <- tryCatch(
      deserialize(api.response),
      error = function(e){
        stop("Failed to deserialize response")
      }
    )

  } else {
    ApiResponse$new(api.response)
  }
}
